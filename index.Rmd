---
title: "Přehled"
output: html_document
---

```{r setup, include=FALSE}
source(here::here("_packages.R"))
source(here::here("R/utils.R"))
knitr::opts_chunk$set(echo = FALSE)

ptrr::set_geom_defaults()
ptrr::set_ptrr_ggplot_fonts()

targets::tar_load(mdf)
targets::tar_load(mdff)
targets::tar_load(g_poly_kraje)
targets::tar_load(g_poly_okresy)
```


```{r map-kraj-csi-priorita}
g_poly_kraje %>% 
  left_join(csi_kraj_priorita, by = c(id = "kraj_kod")) %>% 
  drop_na(typskoly_txt) %>% 
  ggplot(aes(fill = priorita)) +
  geom_sf() +
  facet_wrap(~typskoly_txt)
```

```{r map-kraj-csi-pokryti}
g_poly_kraje %>% 
  left_join(csi_kraj_pokryti, by = c(id = "kraj_kod")) %>% 
  drop_na(skola_druh_nazev) %>% 
  ggplot(aes(fill = csi)) +
  geom_sf(colour = "grey80") + 
  scale_fill_fermenter(direction = 1, labels = label_percent_cz(1)) +
  theme_ptrr(multiplot = T, legend.position = "bottom",
             panel.grid.major = element_line(colour = 'transparent'),
             axis.text.x = element_blank(), axis.text.y = element_blank()) +
  facet_wrap(~skola_druh_nazev)
```

```



```{r}
mdff %>% 
  group_by(kapacita_kat, skola_druh_nazev) %>% 
  filter(skola_druh_nazev %in% c("Střední škola", "Základní škola")) %>% 
  summarise(csi = mean(has_tech_selected, na.rm = T)) %>% 
  spread(skola_druh_nazev, csi)
```
```{r}
mdff %>% 
  group_by(kapacita_kat, skola_druh_nazev) %>% 
  filter(skola_druh_nazev %in% c("Střední škola", "Základní škola")) %>% 
  summarise(big2 = mean(dns_o365 | dns_gsuite, na.rm = T)) %>% 
  spread(skola_druh_nazev, big2)
```


```

  geom_col() +
```


```{r}
csi_recoded %>%
  filter(freetext) %>% 
  count(text_detail, sort = T)
```


```{r}
csi_recoded %>%
  count(priorita, text_detail, sort = T) %>% 
  spread(priorita, n)
```



```

```{r}
options(scipen = 100)
```



```{r}
# tar_visnetwork(T, label = c("size", "time", "branches"))
```

